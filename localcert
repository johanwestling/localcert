#!/bin/bash
source .localcert/bash.sh

cert_name=$1; shift
cert_domains=$@

echo -e ""
echo -e "\033[1mLocalcert\033[0m"
echo -e "\033[32m---------\033[0m"
echo -e ""

if [ -z "$(localcert_bin_path)" ]; then
	echo -e "\033[32m->\033[0m \033[1mDownloading mkcert\033[0m"
	if [ -n "$(localcert_bin_install)" ]; then
		echo -e "\033[1;32m   Done\033[0m"
		echo -e ""
	else
		echo -e "\033[1;31m   Failed\033[0m"
		echo -e ""
		exit 1
	fi
fi

if [ -z "$(localcert_root_path)" ]; then
	echo -e "\033[1;32m->\033[0m \033[1mInstalling rootCA\033[0m"
	if [ -n "$(localcert_root_install)" ]; then
		echo -e "\033[1;32m   Done\033[0m"
		echo -e ""
	else
		echo -e "\033[1;31m   Failed\033[0m"
		echo -e ""
		exit 1
	fi
fi

if [ -z "$cert_name" ]; then
	localcert_help
	exit 0
fi

echo -e "\033[32m->\033[0m \033[1mCopying rootCA\033[0m"
if [ -n "$(localcert_root_copy)" ]; then
	echo -e "\033[1;32m   Done\033[0m"
	echo -e ""
else
	echo -e "\033[1;31m   Failed\033[0m"
	echo -e ""
	exit 1
fi

echo -e "\033[32m->\033[0m \033[1mGenerating certificate\033[0m"
if [ -n "$(localcert_generate $cert_name $cert_domains)" ]; then
	echo -e "\033[1;32m   Done\033[0m"
	echo -e ""
else
	echo -e "\033[1;31m   Failed\033[0m"
	echo -e ""
	exit 1
fi